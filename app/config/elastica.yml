fos_elastica:
  clients:
    default: { host: '%elasticsearch_host%', port: 9200 }
  serializer: ~
  indexes:
    app:
      index_name: app_prod
      settings:
        number_of_shards: 1
        number_of_replicas: 0
        index:
          analysis:
            filter:
              french_elision:
                type: elision
                articles: [l, m, t, qu, n, s, j, d, c, jusqu, quoiqu, lorsqu, puisqu]
              french_stop:
                type: stop
                stopwords: _french_
              french_stemmer:
                type: stemmer
                language: light_french
              autocomplete_filter:
                type: edge_ngram
                min_gram: 1
                max_gram: 20
            analyzer: # We define custom analyzers for html content
              analyse_html_french:
                type: custom
                char_filter: [html_strip]
                tokenizer: standard
                filter: [lowercase, french_elision, french_stop, french_stemmer]
              autocomplete:
                type: custom
                tokenizer: standard
                filter: [lowercase, autocomplete_filter]
      finder: ~
      types:
      # User
        user:
          indexable_callback: isIndexable
          serializer:
            groups: [UsersInfos]
          _all: { enabled: false }
          mappings:
            slug:
              index: not_analyzed
            username:
              analyzer: '%language_analyzer%'
              fields:
                std: { type: string, analyzer: standard }
            biography:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            user_type:
              type: object
              properites:
                id:
                  type: long
          persistence:
            driver: orm
            model: Capco\UserBundle\Entity\User
            provider: ~
            listener: ~
            finder: ~
        # Argument
        argument:
          indexable_callback: isIndexable
          serializer:
            groups: [Opinions, OpinionVersions]
          _all: { enabled: false }
          mappings:
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Argument
            provider: ~
            listener: ~
            finder: ~
        # District
        district:
          serializer:
            groups: [Districts]
          _all: { enabled: false }
          mappings:
            name:
              index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\District
            provider: ~
            listener: ~
            finder: ~
        # Project
        project:
          indexable_callback: isIndexable
          serializer:
            groups: [Opinions, OpinionVersions]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            publishedAt:
              type: date
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Project
            provider: ~
            listener: ~
            finder: ~
        # Comment
        comment:
          indexable_callback: isIndexable
          serializer:
            groups: [Comments]
          _all: { enabled: false }
          mappings:
            body:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
            authorName: ~
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Comment
            provider: ~
            listener: ~
            finder: ~
        # Consultation Step
        consultationStep:
          indexable_callback: isIndexable
          serializer:
            groups: [ConsultationSteps]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Steps\ConsultationStep
            provider: ~
            listener: ~
            finder: ~
        # Event
        event:
          indexable_callback: isIndexable
          serializer:
            groups: [Events]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            startAt:
              type: date
            endAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Event
            provider: ~
            listener: ~
            finder: ~
        # Idea
        idea:
          indexable_callback: isIndexable
          serializer:
            groups: [Ideas]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            object:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Idea
            provider: ~
            listener: ~
            finder: ~
        # Proposal
        proposal:
          indexable_callback: isIndexable
          _all: { enabled: false }
          serializer:
            groups: [Proposals, Themes, UsersInfos]
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
                autocomplete: { type: string, analyzer: autocomplete }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            author:
              type: object
              properties:
                slug:
                  index: not_analyzed
            createdAt:
              type: date
              fields:
                std: { type: string, analyzer: standard }
            updatedAt:
              type: date
            district:
              type: object
              properties:
                name:
                  type: string
                  index: not_analyzed
                id:
                  type: long
            status:
              type: object
              properties:
                id:
                  type: long
                name:
                  type: string
                  index: not_analyzed
            category:
              type: object
              properties:
                id:
                  type: long
                name:
                  type: string
                  index: not_analyzed
            theme:
              type: object
              properties:
                id:
                  type: long
            selections:
              type: object
              properties:
                id:
                  type: long
            likers:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Proposal
            provider: ~
            listener: ~
            finder: ~
        # Proposal vote
        proposalVote:
          indexable_callback: isIndexable
          _all: { enabled: false }
          serializer:
            groups: [ProposalVotes]
          mappings:
            user:
              type: object
              properties:
                slug:
                  index: not_analyzed
            createdAt:
              type: date
              fields:
                std: { type: string, analyzer: standard }
            updatedAt:
              type: date
            proposal:
              type: object
              properties:
                id:
                  type: long
            selectionStep:
              type: object
              properties:
                id:
                  type: long
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\ProposalVote
            provider: ~
            listener: ~
            finder: ~
        # Opinion
        opinion:
          indexable_callback: isIndexable
          serializer:
            groups: [Opinions]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            updatedAt:
              type: date
            createdAt:
              type: date
            Author:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Opinion
            provider: ~
            listener: ~
            finder: ~
        # OpinionVersion
        opinionVersion:
          indexable_callback: isIndexable
          serializer:
            groups: [OpinionVersions]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            author:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\OpinionVersion
            provider: ~
            listener: ~
            finder: ~
        # Post
        post:
          indexable_callback: isIndexable
          serializer:
            groups: [Posts]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            abstract:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            Author:
              type: object
              properties:
                slug:
                  index: not_analyzed
                  fields:
                    std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            publishedAt:
              type: date
            Authors:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Post
            provider: ~
            listener: ~
            finder: ~
        # Source
        source:
          indexable_callback: isIndexable
          serializer:
            groups: [Opinions]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Source
            provider: ~
            listener: ~
            finder: ~
        # Selection
        selection:
          serializer:
            groups: [Proposals, SelectionSteps]
          _all: { enabled: false }
          mappings:
            status:
              type: object
              properties:
                id:
                  type: long
            selectionStep:
              type: object
              properties:
                id:
                  type: long
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Status
            provider: ~
            listener: ~
            finder: ~
        # Selection Step
        consultationStep:
          indexable_callback: isIndexable
          serializer:
            groups: [SelectionSteps]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Steps\SelectionStep
            provider: ~
            listener: ~
            finder: ~
        # Status
        status:
          serializer:
            groups: [Statuses]
          _all: { enabled: false }
          mappings:
            name:
              index: not_analyzed
            color:
              index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Status
            provider: ~
            listener: ~
            finder: ~
        # Category
        category:
          serializer:
            groups: [ProposalCategories]
          _all: { enabled: false }
          mappings:
            name:
              index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\ProposalCategory
            provider: ~
            listener: ~
            finder: ~
        # Theme
        theme:
          indexable_callback: isIndexable
          serializer:
            groups: [Themes]
          _all: { enabled: false }
          mappings:
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            teaser:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            Author:
              type: object
              properties:
                slug:
                  index: not_analyzed
            createdAt:
              type: date
            updatedAt:
              type: date
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Theme
            provider: ~
            listener: ~
            finder: ~
