fos_elastica:
  clients:
    default: { host: '%elasticsearch_host%', port: 9200, retryOnConflict: 5 }
  serializer: ~
  indexes:
    app:
      index_name: app_prod
      settings:
        number_of_shards: 1
        number_of_replicas: 0
        index:
          analysis:
            filter:
              french_elision:
                type: elision
                articles: [l, m, t, qu, n, s, j, d, c, jusqu, quoiqu, lorsqu, puisqu]
              french_stop:
                type: stop
                stopwords: _french_
              french_stemmer:
                type: stemmer
                language: light_french
              autocomplete_filter:
                type: edge_ngram
                min_gram: 1
                max_gram: 20
            analyzer: # We define custom analyzers for html content
              analyse_html_french:
                type: custom
                char_filter: [html_strip]
                tokenizer: standard
                filter: [lowercase, french_elision, french_stop, french_stemmer]
              autocomplete:
                type: custom
                tokenizer: standard
                filter: [lowercase, autocomplete_filter]
      finder: ~
      types:
      # User

        # Argument

        # District

        # Project

        # Comment
        comment:
          indexable_callback: isIndexable
          serializer:
            groups: [Comments]
          _all: { enabled: false }
          mappings:
            id:
              index: not_analyzed
            body:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            createdAt:
              type: date
            updatedAt:
              type: date
            Author:
              type: nested
              properties:
                slug:
                  index: not_analyzed
            authorName: ~
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Comment
            provider: ~
            listener: ~
            finder: ~
        # Consultation Step

        # Event

        # Idea

        # Proposal
        proposal:
          indexable_callback: isIndexable
          _all: { enabled: false }
          serializer:
            groups: [Proposals, ThemeDetails, UsersInfos]
            serialize_null: true
          mappings:
            id:
              index: not_analyzed
            title:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
                autocomplete: { type: string, analyzer: autocomplete }
            fullReference:
              fields:
                std: { type: string, analyzer: standard }
                autocomplete: { type: string, analyzer: autocomplete }
            summary:
              analyzer: '%language_analyzer%'
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            slug:
              index: not_analyzed
            body:
              analyzer: "analyse_html_%language_analyzer%"
              index_options: offsets
              fields:
                std: { type: string, analyzer: standard }
            author:
              type: object
              properties:
                slug:
                  index: not_analyzed
            createdAt:
              type: date
              fields:
                std: { type: string, analyzer: standard }
            updatedAt:
              type: date
            deletedAt:
              type: date
            isTrashed:
              type: boolean
            isDraft:
              type: boolean
            address:
              type: string
              index: not_analyzed
            proposalForm:
              type: object
              properties:
                id:
                  type: string
                  index: not_analyzed
            district:
              type: object
              properties:
                name:
                  type: string
                  index: not_analyzed
                id:
                  type: string
                  index: not_analyzed
            status:
              type: object
              properties:
                id:
                  type: string
                  index: not_analyzed
                name:
                  type: string
                  index: not_analyzed
            category:
              type: object
              properties:
                id:
                  type: string
                  index: not_analyzed
                name:
                  type: string
                  index: not_analyzed
            theme:
              type: object
              properties:
                id:
                  type: string
                  index: not_analyzed
            selections:
              type: object
              properties:
                id:
                  type: string
                  index: not_analyzed
                step:
                  type: object
                  properties:
                    id:
                      type: string
                      index: not_analyzed
                status:
                  type: object
                  properties:
                    id:
                      type: string
                      index: not_analyzed
            likers:
              type: object
              properties:
                slug:
                  index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\Proposal
            provider: ~
            listener: ~
            finder: ~
       # Opinion

        # OpinionVersion

        # Post
        # Source

        # Selection
        # Selection Step
        # Collect Step
        # Status

        # Category
        category:
          serializer:
            groups: [ProposalCategories]
          _all: { enabled: false }
          mappings:
            id:
              index: not_analyzed
            name:
              index: not_analyzed
          persistence:
            driver: orm
            model: Capco\AppBundle\Entity\ProposalCategory
            provider: ~
            listener: ~
            finder: ~
        # Theme
