machine:
    php:
        version: 5.6.5
    services:
        - docker

dependencies:
    cache_directories:
        - ~/docker
        - bower_components
        - node_modules
        - ~/.composer
    override:
        - pip install fabric && pip install pep8 && pip install docker-compose==1.3.0
        - fab testing.circle.load_cache
        - fab testing.circle.save_cache
        - fab testing.infrastructure.up
        - fab testing.app.deploy:environment=prod

    pre:
        - mysql -u ubuntu -e "create database symfony"
        - mysql -u ubuntu -e "create database symfony_test"
    post:
        - wget http://selenium-release.storage.googleapis.com/2.44/selenium-server-standalone-2.44.0.jar
        - java -jar selenium-server-standalone-2.44.0.jar: {background: true}

deployment:
    preprod:
        branch: develop
        commands:
            - "ssh capco@***REMOVED*** 'cd CapCollectif-DeploymentTools && fab deploy:preprod'"
test:
    pre:
        - mysql -u ubuntu -e "create database symfony"
        - mysql -u ubuntu -e "create database symfony_test"

    override:
        - fab testing.qa.behat
        - fab testing.qa.checkcs
        - fab testing.qa.lint
        - pep8 infrastructure/deploylib --ignore=E501
