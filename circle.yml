dependencies:
    override:
        - sudo composer self-update && composer install --no-interaction -vvv:
            timeout: 3600
    pre:
        - echo "memory_limit = 2048M" > ~/.phpenv/versions/$(phpenv global)/etc/conf.d/memory.ini
        - mv app/config/parameters.ci.yml app/config/parameters.yml
        - gem install bundler
        - bundle install --clean
    post:
        - wget http://selenium-release.storage.googleapis.com/2.44/selenium-server-standalone-2.44.0.jar
        - java -jar selenium-server-standalone-2.44.0.jar:
            background: true

deployment:
    preprod:
        branch: develop
        commands:
            - bundle exec cap preprod deploy


machine:
    php:
        version: 5.5.15

test:
    pre:
        - echo "memory_limit = 2048M" > ~/.phpenv/versions/$(phpenv global)/etc/conf.d/memory.ini
        - app/console doctrine:database:create --env test
        - app/console doctrine:schema:update --force --env test -n
        - npm install && bower install
        - npm install -g gulp
        - app/console server:run:
            background: true

    override:
        - app/console doctrine:migrations:migrate -n
        - gulp build
        - bin/phpspec run
        - bin/behat
