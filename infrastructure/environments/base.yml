application:
    build: ../services/local
    ports:
        - "80:80"
    environment:
        SYMFONY_MAILER_HOST: mailcatchersmtp
        SYMFONY_MAILER_PORT: 25
        SYMFONY_DATABASE_HOST: database
        SYMFONY_ELASTICSEARCH_HOST: elasticsearch
        SYMFONY_REDIS_HOST: redis
        SYMFONY_SERVER_VERSION: 5.5.46-0+deb8u1
    volumes_from:
        - applicationdata
    links:
        - database:database
        - elasticsearch:elasticsearch
        - redis:redis
        - seleniumhub:selenium
        - mailcatcher:mailcatchersmtp
    extra_hosts: # Used to ban varnish cache
        - "capco.test:0.0.0.0"

applicationdata:
    build: ../services/applicationdata
    volumes:
        - /var/www/web/media
        - /var/www/var/cache
        - /var/www/var/logs

database:
    image: capco/fixtures:latest

redis:
    image: redis:3

builder:
    build: ../services/builder
    volumes:
        - ../../:/var/www
        - ~/.composer:/home/capco/.composer
        - ~/.npm:/home/capco/.npm
        - ~/.bower:/home/capco/.bower
    command: echo "Use 'docker-compose run builder build' to build deps"

seleniumhub:
  image: selenium/hub:2.47.1 # Fixed version to avoid a Mink issue (https://github.com/Behat/MinkExtension/issues/224)
  ports:
    - "4444:4444"

mailcatcher:
  image: jderusse/mailcatcher:latest
  ports:
    - "25:25"

chrome:
   image: selenium/node-chrome-debug:2.47.1
   links:
     - seleniumhub:hub
     - application:capco.test
