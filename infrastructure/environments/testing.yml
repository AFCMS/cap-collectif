services:
  application:
    environment:
      DOCKER_GID: 998
      BLACKFIRE_LOG_LEVEL: 1
      CI: ${CI}
      CIRCLE_JOB: ${CIRCLE_JOB}
      # Set the following variables on CircleCI
      # https://app.circleci.com/settings/project/github/cap-collectif/platform/environment-variables
      SYMFONY_GOOGLE_MAP_PUBLIC_KEY: ${SYMFONY_GOOGLE_MAP_PUBLIC_KEY}
      SYMFONY_GOOGLE_MAP_SERVER_KEY: ${SYMFONY_GOOGLE_MAP_SERVER_KEY}
      SYMFONY_MAPBOX_SECRET_KEY: ${SYMFONY_MAPBOX_SECRET_KEY}
      SYMFONY_RECAPTCHA_PRIVATE_KEY: ${SYMFONY_RECAPTCHA_PRIVATE_KEY}
      SYMFONY_PANTHER_URL: ${SYMFONY_PANTHER_URL}
      SYMFONY_PANTHER_TOKEN: ${SYMFONY_PANTHER_TOKEN}
      SYMFONY_MAILJET_PRIVATE_KEY: ${SYMFONY_MAILJET_PRIVATE_KEY}
      SYMFONY_MAILJET_PUBLIC_KEY: ${SYMFONY_MAILJET_PUBLIC_KEY}
      SYMFONY_MANDRILL_API_KEY: ${SYMFONY_MANDRILL_API_KEY}
      SYMFONY_REMEMBER_SECRET: ${SYMFONY_REMEMBER_SECRET}
      SYMFONY_TWILIO_SID: ${SYMFONY_TWILIO_SID}
      SYMFONY_TWILIO_TOKEN: ${SYMFONY_TWILIO_TOKEN}
      SYMFONY_TWILIO_DEFAULT_ALPHA_SENDER_ID: ${SYMFONY_TWILIO_DEFAULT_ALPHA_SENDER_ID}
      SYMFONY_TWILIO_DEFAULT_SERVICE_ID: ${SYMFONY_TWILIO_DEFAULT_SERVICE_ID}
      SYMFONY_LOGPUSH_ELASTICSEARCH_HOST: ${SYMFONY_LOGPUSH_ELASTICSEARCH_HOST}
      SYMFONY_LOGPUSH_ELASTICSEARCH_INDEX: ${SYMFONY_LOGPUSH_ELASTICSEARCH_INDEX}
      SYMFONY_LOGPUSH_ELASTICSEARCH_USERNAME: ${SYMFONY_LOGPUSH_ELASTICSEARCH_USERNAME}
      SYMFONY_LOGPUSH_ELASTICSEARCH_PASSWORD: ${SYMFONY_LOGPUSH_ELASTICSEARCH_PASSWORD}
    volumes:
      - ../../:/var/www
      - /etc/localtime:/etc/localtime:ro
      - /tmp:/tmp

  database:
    image: circleci/mariadb:10.3
    volumes:
      - /tmp:/tmp

  redis:
    image: circleci/redis:3
    ports:
      - '6379:6379'
