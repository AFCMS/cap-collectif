FROM capco_builder

LABEL maintainer "Cap Collectif <tech@cap-collectif.com>"

RUN pip install pycodestyle

# Install php-cs-fixer
RUN wget --quiet https://github.com/FriendsOfPHP/PHP-CS-Fixer/releases/download/v2.12.0/php-cs-fixer.phar -O /usr/local/bin/php-cs-fixer && \
    chmod +x /usr/local/bin/php-cs-fixer

COPY capco.ini /usr/local/etc/php/conf.d/capco.ini

# Install fake user 1000
RUN mkdir -m 777 -p /home/capco
RUN groupadd --gid=1000 capco && \
    /usr/sbin/useradd --system --uid=1000 --home /home/capco --shell /bin/bash -g capco capco
RUN chown -R capco /usr/local /usr/bin /usr/lib

# Add composer global binaries to $PATH
ENV PATH $PATH:/home/capco/.composer/vendor/bin/

RUN yarn global add jest flow-bin@0.70.0 bundlesize eslint

WORKDIR /var/www

USER capco

CMD ["echo", "QA runner container for application"]
