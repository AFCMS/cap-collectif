server {

    listen 80;
    server_name %%DOMAINS%%;

# Ici on d√©sactive les access_log pour ne pas faire doublon avec Apache
    access_log off;
    server_tokens off;

    if ($request_method !~ ^(GET|HEAD|POST)$ ) {
        return 444;
    }


    location / {
        proxy_pass http://127.0.0.1:%%PORT%%/;
        proxy_set_header Host $host;
        #proxy_set_header Host $host:49000;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # proxy_cache cache;
        # proxy_cache_valid 12h;
        # expires 12h;
        proxy_cache_use_stale error timeout invalid_header updating;
    }


    location ~* ^.+(ttf|otf|eot|woff|swf|jpg|jpeg|gif|png|ico|css|zip|tgz|gz|rar|bz2|doc|xls|exe|pdf|ppt|txt|tar|js|webm|mp4|ogv)$ {
        proxy_pass http://127.0.0.1:%%PORT%%;
        proxy_hide_header       Set-Cookie;
        proxy_ignore_headers    Set-Cookie;
        # important! Remember the special inheritance rules for proxy_set_header:
        # http://nginx.org/ru/docs/http/ngx_http_proxy_module.html#proxy_set_header
        proxy_set_header        Cookie "";

        #proxy_cache cache;
        #proxy_cache_valid 2d;
        expires max;
    }
    location ~* \.(eot)|(ttf)|(woff)|(svg)|(otf)$ {
        add_header Access-Control-Allow-Origin *;
        expires max;
        log_not_found off;
    }




    error_page 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 500 501 502 503 504 505 506 507 /error.html;

    location = /error.html {
        root /home/projects/candidats/smartgov-candidat-hosting/server/landing;
    }
}

