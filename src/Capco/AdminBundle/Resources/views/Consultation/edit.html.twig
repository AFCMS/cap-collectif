{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">

        $(document).ready(function(){
            var consultationType = $("#{{ admin.uniqId }}_consultationType");
            consultationType.on('change', function() {
                updateAllowedTypes();
            });

            function updateAllowedTypes() {
                $('#{{ admin.uniqId }}_allowedTypes_2').prop('checked', false);
                var consultationTypeId = $("#{{ admin.uniqId }}_consultationType option:selected").val();
                var allowedTypes = $("#field_container_{{ admin.uniqId }}_allowedTypes input[type='checkbox']");

                var url = "{{ admin.generateUrl('getAllowedTypesFromConsultationType', {}) }}";
                $.get(url, {'consultationTypeId': consultationTypeId}, function(data){

                    if (data.length > 0) {
                        $(allowedTypes).each(function(){
                            $(this).prop('checked', false);
                            if ($.inArray($(this).val(), data) != -1) {
                                $(this).prop('checked', true);
                            } else {
                                $(this).prop('checked', false);
                            }
                            $(this).iCheck('update');
                        });
                    }

                    $(consultationType).select2('val', '');

                });
            }
        });
    </script>
{% endblock %}
