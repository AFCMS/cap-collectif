{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% block form %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready( function() {

            $(document).on('click', '#sonata-ba-field-container-{{ admin.uniqid }}_questions .sonata-ba-action', function() {
              $('ul > li:nth-child(2)').hide();
            });

            const usingThemesField = $("input#{{ admin.uniqid }}_usingThemes");
            const themeHelpTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_themeHelpText");
            const themeMandatoryField = $("#sonata-ba-field-container-{{ admin.uniqid }}_themeMandatory");

            const usingDistrictField = $("input#{{ admin.uniqid }}_usingDistrict");
            const districtMandatoryField = $("#sonata-ba-field-container-{{ admin.uniqid }}_districtMandatory");

            const usingCategoriesField = $("input#{{ admin.uniqid }}_usingCategories");
            const categoryHelpTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_categoryHelpText");
            const districtHelpTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_districtHelpText");
            const categoryMandatoryField = $("#sonata-ba-field-container-{{ admin.uniqid }}_categoryMandatory");
            const categoriesGroup = $("#sonata-ba-field-container-{{ admin.uniqid }}_categories");

            const usingAddressField = $("input#{{ admin.uniqid }}_usingAddress");
            const addressMandatoryField = $("#sonata-ba-field-container-{{ admin.uniqid }}_addressMandatory");
            const addressHelpTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_addressHelpText");
            const latTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_latMap");
            const lngTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_lngMap");
            const zoomTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_zoomMap");

            // MAP

            function toggleField(show, mandatoryField, helpField, categoryField) {
                if (show) {
                    mandatoryField.removeClass('hidden');
                    if (helpField !== null) {
                      helpField.removeClass('hidden');
                    }
                    if (categoryField !== null) {
                      categoryField.removeClass('hidden');
                    }
                } else {
                    mandatoryField.addClass('hidden');
                    if (helpField !== null) {
                      helpField.addClass('hidden');
                    }
                    if (categoryField !== null) {
                      categoryField.addClass('hidden');
                    }
                }
            }

            function toggleFieldMap(show, mandatoryField, helpField, latField, lngField, zoomField) {
                if (show) {
                    mandatoryField.removeClass('hidden');
                    helpField.removeClass('hidden');
                    latField.removeClass('hidden');
                    lngField.removeClass('hidden');
                    zoomField.removeClass('hidden');
                } else {
                    mandatoryField.addClass('hidden');
                    helpField.addClass('hidden');
                    latField.addClass('hidden');
                    lngField.addClass('hidden');
                    zoomField.addClass('hidden');
                }
            }

            // For Themes
            toggleField(usingThemesField.prop('checked'), themeMandatoryField, themeHelpTextField, null);

            // For Categories
            toggleField(usingCategoriesField.prop('checked'), categoryMandatoryField, categoryHelpTextField, categoriesGroup);

            // For Address
            toggleFieldMap(usingAddressField.prop('checked'), addressMandatoryField, addressHelpTextField, latTextField, lngTextField, zoomTextField);

            // For District
            toggleField(usingDistrictField.prop('checked'), districtMandatoryField, districtHelpTextField, null);

            usingThemesField.on('ifChanged', function(e) {
                $(e.target).iCheck('update');
                toggleField($(e.target).prop('checked'), themeMandatoryField, themeHelpTextField, null);
            });

            usingCategoriesField.on('ifChanged', function(e) {
                $(e.target).iCheck('update');
                toggleField($(e.target).prop('checked'), categoryMandatoryField, categoryHelpTextField, categoriesGroup);
            });

            usingDistrictField.on('ifChanged', function(e) {
                $(e.target).iCheck('update');
                toggleField($(e.target).prop('checked'), districtMandatoryField, districtHelpTextField, null);
            });

            usingAddressField.on('ifChanged', function(e) {
                $(e.target).iCheck('update');
                toggleFieldMap($(e.target).prop('checked'), addressMandatoryField, addressHelpTextField, latTextField, lngTextField, zoomTextField);
            });
        });
    </script>
{% endblock %}
