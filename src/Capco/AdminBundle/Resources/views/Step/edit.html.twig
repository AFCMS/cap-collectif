{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% block form %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready( function() {

            const voteTypeField = $("#{{ admin.uniqid }}_voteType");
            const votesHelpTextField = $("#sonata-ba-field-container-{{ admin.uniqid }}_votesHelpText");
            const budgetField = $("#sonata-ba-field-container-{{ admin.uniqid }}_budget");

            function toggleVotesHelpTextField(show) {
                if (show) {
                    votesHelpTextField.removeClass('hidden');
                } else {
                    votesHelpTextField.addClass('hidden');
                }
            }

            function toggleBudgetField(show) {
                if (show) {
                    budgetField.removeClass('hidden');
                } else {
                    budgetField.addClass('hidden');
                }
            }

            const initialValue = voteTypeField.val();
            toggleVotesHelpTextField(initialValue === "1" || initialValue === "2");
            toggleBudgetField(initialValue === "2");

            voteTypeField.on('change', function(e) {
                toggleVotesHelpTextField(e.target.value === "1" || e.target.value === "2");
                toggleBudgetField(e.target.value === "2");
            });

            const voteThresholdCheckbox = $("#{{ admin.uniqid }}_hasVoteThreshold");
            const voteThresholdField = $("#sonata-ba-field-container-{{ admin.uniqid }}_voteThreshold");
            const voteThresholdInput = $("#{{ admin.uniqid }}_voteThreshold");

            function toggleVoteThresholdField(show) {
                if (show) {
                    voteThresholdField.removeClass('hidden');
                } else {
                    voteThresholdField.addClass('hidden');
                }
            }

            const initialVoteThresholdValue = voteThresholdInput.val();
            toggleVoteThresholdField(initialVoteThresholdValue > 0);

            voteThresholdCheckbox.on('ifChecked', function(e){
                toggleVoteThresholdField(true);
            });

            voteThresholdCheckbox.on('ifUnchecked', function () {
                toggleVoteThresholdField(false);
                voteThresholdInput.val(0);
            });
        });
    </script>
{% endblock %}
