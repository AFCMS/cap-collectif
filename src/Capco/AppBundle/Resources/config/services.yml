parameters:
    capco.site_parameter.repository.class: Capco\AppBundle\Repository\SiteParameterRepository
    capco.menu_item.repository.class: Capco\AppBundle\Repository\MenuItemRepository
    capco.menu_item.resolver.class: Capco\AppBundle\Manager\MenuItemResolver
    capco.site_parameter.resolver.class: Capco\AppBundle\SiteParameter\Resolver
    capco.twig_extension.site_parameter.class: Capco\AppBundle\Twig\SiteParameterExtension
    capco.site_image.repository.class: Capco\AppBundle\Repository\SiteImageRepository
    capco.site_image.resolver.class: Capco\AppBundle\SiteImage\Resolver
    capco.twig_extension.site_image.class: Capco\AppBundle\Twig\SiteImageExtension
    capco.twig_extension.menu_url.class: Capco\AppBundle\Twig\MenuLinkExtension
    capco.twig_extension.feature_toggle.class: Capco\AppBundle\Twig\FeatureToggleExtension
    capco.notify.manager.class: Capco\AppBundle\Manager\Notify
    capco.toggle.manager.class: Capco\AppBundle\Toggle\Manager
    capco.toggle.listener.request.class: Capco\AppBundle\Toggle\RequestListener
    capco.blog.post.repository.class: Capco\AppBundle\Repository\PostRepository
    capco.event.repository.class: Capco\AppBundle\Repository\EventRepository
    capco.event.resolver.class: Capco\AppBundle\Manager\EventResolver
    capco.comment.resolver.class: Capco\AppBundle\Manager\CommentResolver
    capco.twig.comment.class: Capco\AppBundle\Twig\CommentExtension
    capco.site_color.repository.class: Capco\AppBundle\Repository\SiteColorRepository
    capco.site_color.resolver.class: Capco\AppBundle\SiteColor\Resolver
    capco.twig_extension.site_color.class: Capco\AppBundle\Twig\SiteColorExtension
    capco.twig.default_avatar.class: Capco\AppBundle\Twig\DefaultAvatarExtension
    capco.step.resolver.class: Capco\AppBundle\Manager\StepResolver
    capco.twig.steps_links.class: Capco\AppBundle\Twig\StepsLinksExtension
    capco.block.service.share_button.class: Capco\AppBundle\Block\ShareButtonBlockService
    capco.video.repository.class: Capco\AppBundle\Repository\VideoRepository
    capco.consultation.download.resolver.class: Capco\AppBundle\Resolver\ConsultationDownloadResolver

services:
    capco.site_parameter.repository:
        class: %capco.site_parameter.repository.class%
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - Capco\AppBundle\Entity\SiteParameter

    capco.site_parameter.resolver:
        class: %capco.site_parameter.resolver.class%
        arguments:
            - @capco.site_parameter.repository
            - @logger

    capco.twig.site_parameter:
        class: %capco.twig_extension.site_parameter.class%
        arguments: [ @capco.site_parameter.resolver ]
        tags:
            - { name: twig.extension }

    ## Site paramèters for Image
    capco.site_image.repository:
        class: %capco.site_image.repository.class%
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - Capco\AppBundle\Entity\SiteImage

    capco.site_image.resolver:
        class: %capco.site_image.resolver.class%
        arguments:
            - @capco.site_image.repository
            - @logger

    capco.twig.site_image:
        class: %capco.twig_extension.site_image.class%
        arguments: [ @capco.site_image.resolver ]
        tags:
            - { name: twig.extension }

    # default avatar
    capco.twig.default_avatar:
         class: %capco.twig.default_avatar.class%
         arguments:
             - @capco.site_image.resolver
         tags:
            - { name: twig.extension }

    ## Site paramèters for colors
    capco.site_color.repository:
        class: %capco.site_color.repository.class%
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - Capco\AppBundle\Entity\SiteColor

    capco.site_color.resolver:
        class: %capco.site_color.resolver.class%
        arguments:
            - @capco.site_color.repository
            - @logger

    capco.twig.site_color:
        class: %capco.twig_extension.site_color.class%
        arguments: [ @capco.site_color.resolver ]
        tags:
            - { name: twig.extension }

    ## Menu URL
    capco.twig.menu_url:
        class: %capco.twig_extension.menu_url.class%
        arguments: [ @router, @validator ]
        tags:
            - { name: twig.extension }

    capco.form.type_extension.media:
        class: Capco\AppBundle\Form\Extension\MediaTypeExtension
        tags:
            - { name: form.type_extension, alias: sonata_media_type }

    ## Service Notify - send mail
    capco.notify_manager:
        class:     %capco.notify.manager.class%
        arguments: [@mailer, @templating, @translator, @capco.site_parameter.resolver]

    ## Toggle
    capco.toggle.manager:
        class:     %capco.toggle.manager.class%
        arguments: [@qandidate.toggle.manager, @qandidate.toggle.user_context_factory, "%redis_prefix%" ]

    capco.toggle.listener.request:
        class:     %capco.toggle.listener.request.class%
        arguments: [@capco.toggle.manager, @translator, @capco.site_parameter.resolver]
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

    capco.twig.feature_toggle:
        class:     %capco.twig_extension.feature_toggle.class%
        arguments: [@capco.toggle.manager]
        tags:
            - { name: twig.extension }

    capco.blog.post.repository:
        class:           "%capco.blog.post.repository.class%"
        factory_service: doctrine.orm.entity_manager
        factory_method:  getRepository
        arguments:       ['CapcoAppBundle:Post']

    capco.event.repository:
        class:           "%capco.event.repository.class%"
        factory_service: doctrine.orm.entity_manager
        factory_method:  getRepository
        arguments:       ['CapcoAppBundle:Event']

    capco.event.resolver:
        class: %capco.event.resolver.class%
        arguments: [@capco.event.repository]

    capco.video.repository:
        class:           "%capco.video.repository.class%"
        factory_service: doctrine.orm.entity_manager
        factory_method:  getRepository
        arguments:       ['CapcoAppBundle:Video']

    capco.menu_item.repository:
        class: %capco.menu_item.repository.class%
        factory_service: doctrine.orm.default_entity_manager
        factory_method: getRepository
        arguments:
            - Capco\AppBundle\Entity\MenuItem

    capco.menu_item.resolver:
        class: %capco.menu_item.resolver.class%
        arguments: [@capco.menu_item.repository, @capco.toggle.manager]

    capco.step.resolver:
        class: %capco.step.resolver.class%
        arguments: [@router]

    capco.comment.resolver:
        class: %capco.comment.resolver.class%
        arguments: [@doctrine.orm.entity_manager, @router]

    capco.twig.comment:
        class: %capco.twig.comment.class%
        arguments: [@capco.comment.resolver]
        tags:
          - { name: twig.extension }

    capco.twig.steps_links:
        class:     %capco.twig.steps_links.class%
        arguments: [@capco.step.resolver]
        tags:
            - { name: twig.extension }

    capco.block.service.share_button:
        class:     %capco.block.service.share_button.class%
        arguments: [capco.block.service.share_button, @templating]
        tags:
            - { name: sonata.block }

    capco.consultation.download.resolver:
        class: %capco.consultation.download.resolver.class%
        arguments: [@doctrine.orm.entity_manager, @templating, @translator]

    capco.event.helper:
        class: Capco\AppBundle\Helper\EventHelper

    capco.unlisted_email.validator:
        class: Capco\AppBundle\Validator\Constraints\HasUnlistedEmailValidator
        arguments: [@doctrine.orm.entity_manager]
        tags:
            - { name: validator.constraint_validator, alias: unlisted_email.validator }
