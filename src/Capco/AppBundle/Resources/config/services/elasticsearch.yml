services:
  _defaults:
    autoconfigure: true
    autowire: true
    public: false

  Capco\AppBundle\Elasticsearch\:
    resource: '%kernel.root_dir%/../src/Capco/AppBundle/Elasticsearch/*'

  capco.elasticsearch.client:
    class: Elastica\Client
    autowire: true
    public: true
    arguments:
      - connections:
          - { host: '%elasticsearch_host%', port: '9200' }

  capco.elasticsearch.index_builder:
    class: Capco\AppBundle\Elasticsearch\IndexBuilder
    autowire: true
    public: true

  capco.elasticsearch.indexer:
    class: Capco\AppBundle\Elasticsearch\Indexer
    autowire: true
    public: true

  capco.elasticsearch.index:
    class: Elastica\Index
    autowire: true
    public: true
    factory: ['@capco.elasticsearch.index_builder', getLiveSearchIndex]

  capco.elasticsearch.elastica_to_doctrine_transformer:
    class: Capco\AppBundle\Elasticsearch\ElasticaToDoctrineTransformer
    autowire: true
    public: true
    calls:
      - ['setPropertyAccessor', ['@property_accessor']]

  capco.elasticsearch.listener:
    class: Capco\AppBundle\Elasticsearch\DoctrineUpdateListener
    autowire: true
    public: true
    tags:
      - { name: doctrine.event_subscriber, connection: default }
