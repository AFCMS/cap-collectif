services:
  _defaults:
    autoconfigure: true
    autowire: true
    public: false

  Capco\AppBundle\EventListener\:
    resource: '%kernel.root_dir%/../src/Capco/AppBundle/EventListener/*'

  capco.listener.soft_delete:
    class: Capco\AppBundle\EventListener\SoftDeleteEventListener
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }

  capco.listener.feature_toggle:
    class: Capco\AppBundle\EventListener\FeatureToggleListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  capco.listener.paris_authentication_exception:
    class: Capco\AppBundle\EventListener\ParisAuthenticationExceptionListener
    tags:
      - { name: kernel.event_listener, event: kernel.exception }

  capco.listener.locale:
    class: Capco\AppBundle\EventListener\LocaleListener
    tags:
      - {
          name: kernel.event_listener,
          event: kernel.request,
          method: onKernelRequest,
          priority: 15,
        }

  capco.listener.shield:
    class: Capco\AppBundle\EventListener\ShieldListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  capco.listener.empty_username:
    public: true
    class: Capco\AppBundle\EventListener\EmptyUsernameListener
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  Capco\AppBundle\Publishable\DoctrineListener:
    public: true
    tags:
      - { name: doctrine.event_subscriber, connection: default }

  capco.diff.subscriber:
    class: Capco\AppBundle\EventListener\DiffSubscriber
    tags:
      - { name: doctrine.event_subscriber, connection: default }

  capco.listener.reference:
    public: true
    class: Capco\AppBundle\EventListener\ReferenceEventListener
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }

  capco.listener.moderation_token:
    public: true
    class: Capco\AppBundle\EventListener\ModerationTokenListener
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }

  Capco\AppBundle\EventListener\ProjectAccessDeniedExceptionListener:
    public: true
    tags:
      - { name: kernel.event_listener, event: kernel.exception, priority: 250 }

  Capco\AppBundle\GraphQL\EventListener\ErrorHandler:
    autowire: true
    tags:
      - { name: kernel.event_listener, event: graphql.post_executor, method: onPostExecutor }

  Overblog\GraphQLBundle\Error\ErrorHandler:
    autowire: true
    autoconfigure: true

  capco.form.transformer.html_purifier:
    class: Exercise\HTMLPurifierBundle\Form\HTMLPurifierTransformer
    arguments: ['@exercise_html_purifier.default']

  capco.doctrine.subscriber.dynamic_relation:
    class: Capco\AppBundle\EventListener\DynamicRelationSubscriber
    tags:
      - { name: doctrine.event_subscriber, event: loadClassMetadata }
    arguments: ['%traits%']

  Capco\AppBundle\EventListener\ProjectSerializationListener:
    public: true
    autowire: true

  Capco\AppBundle\EventListener\SerializationListener:
    public: true
    autowire: true

  Capco\AppBundle\EventListener\ThemeSerializationListener:
    public: true
    autowire: true

  Capco\AppBundle\EventListener\ProposalSerializationListener:
    public: true
    autowire: true

  #  capco.event.serialization_listener:
  Capco\AppBundle\EventListener\EventSerializationListener:
    public: true
    autowire: true

  #  capco.media_response.serialization_listener:
  Capco\AppBundle\EventListener\MediaResponseSerializationListener:
    public: true
    tags:
      - { name: 'jms_serializer.event_subscriber' }

  #  capco.source.serialization_listener:
  Capco\AppBundle\EventListener\SourceSerializationListener:
    public: true
    autowire: true

  #  capco.opinion.serialization_listener:
  Capco\AppBundle\EventListener\OpinionSerializationListener:
    public: true
    autowire: true

  #  capco.user.serialization_listener:
  Capco\AppBundle\EventListener\UserSerializationListener:
    public: true
    autowire: true

  #  capco.post.serialization_listener:
  Capco\AppBundle\EventListener\PostSerializationListener:
    public: true
    autowire: true

  #  capco.synthesis.synthesis_listener:
  Capco\AppBundle\EventListener\SynthesisLoggableListener:
    public: true
    calls:
      - [setAnnotationReader, ['@annotation_reader']]

  #  capco.opinion_type.serialization_listener:
  Capco\AppBundle\EventListener\OpinionTypeSerializationListener:
    public: true
    autowire: true

  #  capco.proposal_vote.serialization_listener:
  Capco\AppBundle\EventListener\ProposalVoteSerializationListener:
    public: true
    autowire: true

  #  capco.selection_step.serialization_listener:
  Capco\AppBundle\EventListener\SelectionStepSerializationListener:
    public: true
    autowire: true

  #  capco.consultation_step.serialization_listener:
  Capco\AppBundle\EventListener\ConsultationStepSerializationListener:
    public: true
    autowire: true

  #  capco.collect_step.serialization_listener:
  Capco\AppBundle\EventListener\CollectStepSerializationListener:
    public: true
    autowire: true

  #  capco.questionnaire_step.serialization_listener:
  Capco\AppBundle\EventListener\QuestionnaireStepSerializationListener:
    public: true
    autowire: true

  #  capco.abstract_step.serialization_listener:
  Capco\AppBundle\EventListener\AbstractStepSerializationListener:
    public: true
    autowire: true

  #  capco.question_choice.serialization_listener:
  Capco\AppBundle\EventListener\QuestionChoiceSerializationListener:
    public: true
    autowire: true
