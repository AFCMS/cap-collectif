services:
  capco.listener.soft_delete:
    class: Capco\AppBundle\EventListener\SoftDeleteEventListener
    public: false
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }

  capco.listener.feature_toggle:
    class: Capco\AppBundle\EventListener\FeatureToggleListener
    arguments:
      - "@capco.toggle.manager"
      - "@translator"
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  capco.listener.locale:
    class: Capco\AppBundle\EventListener\LocaleListener
    arguments:
      - "@capco.site_parameter.resolver"
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 15 }

  capco.listener.shield:
    class: Capco\AppBundle\EventListener\ShieldListener
    arguments:
      - "@capco.toggle.manager"
      - "@security.token_storage"
      - "@templating"
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  capco.listener.empty_username:
    class: Capco\AppBundle\EventListener\EmptyUsernameListener
    arguments:
      - "@security.token_storage"
      - "@templating"
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }

  capco.diff.subscriber:
    class: Capco\AppBundle\EventListener\DiffSubscriber
    arguments: ["@capco.diff.generator"]
    tags:
        - { name: doctrine.event_subscriber, connection: default }

  capco.serialization_listener:
    class: Capco\AppBundle\EventListener\SerializationListener
    arguments: ["@capco.synthesis.log_manager", "@sonata.media.twig.extension", "@jms_serializer"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.comment.serialization_listener:
    class: Capco\AppBundle\EventListener\CommentSerializationListener
    arguments: ["@router", "@security.token_storage"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.theme.serialization_listener:
    class: Capco\AppBundle\EventListener\ThemeSerializationListener
    arguments: ["@router"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.argument.serialization_listener:
    class: Capco\AppBundle\EventListener\ArgumentSerializationListener
    arguments: ["@router", "@security.token_storage"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.proposal.serialization_listener:
    class: Capco\AppBundle\EventListener\ProposalSerializationListener
    arguments:
      - "@router"
      - "@security.token_storage"
      - "@capco.proposal_selection_vote.repository"
      - "@capco.response.repository"
      - "@sonata.media.twig.extension"
      - "@jms_serializer"
      - "@capco.proposal_collect_vote.repository"
      - "@capco.proposal_votes.resolver"
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.media_response.serialization_listener:
    class: Capco\AppBundle\EventListener\MediaResponseSerializationListener
    arguments: ["@jms_serializer", "@router", "@sonata.core.twig.template_extension"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.source.serialization_listener:
    class: Capco\AppBundle\EventListener\SourceSerializationListener
    arguments: ["@security.token_storage"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.opinion.serialization_listener:
    class: Capco\AppBundle\EventListener\OpinionSerializationListener
    arguments:
      - "@router"
      - "@security.token_storage"
      - "@capco.abstract_vote.repository"
      - "@capco.toggle.manager"
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.user.serialization_listener:
    class: Capco\AppBundle\EventListener\UserSerializationListener
    arguments: ["@router", "@capco.toggle.manager"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.post.serialization_listener:
    class: Capco\AppBundle\EventListener\PostSerializationListener
    arguments: ["@router"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.synthesis.synthesis_listener:
    class: Capco\AppBundle\EventListener\SynthesisLoggableListener
    calls:
      - [ setAnnotationReader, [ "@annotation_reader" ] ]

  capco.opinion_type.serialization_listener:
    class: Capco\AppBundle\EventListener\OpinionTypeSerializationListener
    arguments:
      - "@capco.opinion_types.resolver"
      - "@jms_serializer"
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.proposal_vote.serialization_listener:
    class: Capco\AppBundle\EventListener\ProposalVoteSerializationListener
    arguments:
      - "@translator"
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.selection_step.serialization_listener:
    class: Capco\AppBundle\EventListener\SelectionStepSerializationListener
    arguments: [ "@jms_serializer", "@router"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.consultation_step.serialization_listener:
    class: Capco\AppBundle\EventListener\ConsultationStepSerializationListener
    arguments: []
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.collect_step.serialization_listener:
    class: Capco\AppBundle\EventListener\CollectStepSerializationListener
    arguments: []
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.questionnaire_step.serialization_listener:
    class: Capco\AppBundle\EventListener\QuestionnaireStepSerializationListener
    arguments: []
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.project.serialization_listener:
    class: Capco\AppBundle\EventListener\ProjectSerializationListener
    arguments: ["@capco.step.resolver", "@sonata.media.twig.extension", "@jms_serializer", "@capco.project.helper", "@router" ]
    tags:
     - { name: "jms_serializer.event_subscriber" }

  capco.abstract_step.serialization_listener:
    class: Capco\AppBundle\EventListener\AbstractStepSerializationListener
    arguments: ["@capco.step.helper"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.question_choice.serialization_listener:
    class: Capco\AppBundle\EventListener\QuestionChoiceSerializationListener
    arguments: ["@sonata.media.twig.extension"]
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.idea.serialization_listener:
     class: Capco\AppBundle\EventListener\IdeaSerializationListener
     arguments: ["@router", "@security.token_storage", "@sonata.media.twig.extension", "@capco.idea.helper"]
     tags:
       - { name: "jms_serializer.event_subscriber" }

  capco.idea_vote.serialization_listener:
    class: Capco\AppBundle\EventListener\IdeaVoteSerializationListener
    tags:
      - { name: "jms_serializer.event_subscriber" }

  capco.listener.reference:
    class: Capco\AppBundle\EventListener\ReferenceEventListener
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }

  capco.listener.moderation_token:
    class: Capco\AppBundle\EventListener\ModerationTokenListener
    arguments:
      - "@fos_user.util.token_generator"
    tags:
      - { name: doctrine.event_listener, event: preFlush, method: preFlush }
