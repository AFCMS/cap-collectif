{% set opinion = argument.opinion %}
{% set consultation = opinion.consultation %}
{% set opinionType = opinion.opinionType %}
<li class="opinion  opinion--argument {% if classes is defined %}{{ classes }}{% endif %}" id="arg-{{ argument.id }}">
    <div class="opinion__body  box">
        {% if argument.Author is not null %}
            {% include 'CapcoUserBundle:Avatar:avatar.html.twig' with { 'user': argument.Author, 'classes': '', 'link_classes': 'pull-left'} only %}
        {% endif %}
        <div class="opinion__data">
            <p class="h5  opinion__user">
                <a href="{{ path('capco_user_profile_show_all', {'slug': argument.Author.slug}) }}">
                    {{ argument.Author.username }}
                </a>
                {% if trashed is defined or profile is defined %}
                    <span class="label  label--right {% if argument.type == 0 %}label-danger{% elseif argument.type == 1 %}label-success{% endif %}">
                        {{ argumentsLabels[argument.type] | trans({}, 'CapcoAppBundle') | capitalize }}
                    </span>
                {% endif %}
            </p>
            <p class="excerpt  opinion__date">{{ argument.createdAt | localizeddate('long', 'short', app.request.locale) }}</p>
            {% if trashed is defined or profile is defined %}
                <p>{{ 'argument.trashed.linked_proposition' | trans({}, 'CapcoAppBundle') }} <a href="{{ path('app_consultation_show_opinion', {'consultationSlug': consultation.slug, 'opinionTypeSlug': argument.Opinion.OpinionType.slug, 'opinionSlug': argument.Opinion.slug}) }}">{{ argument.Opinion.title }}</a></p>
            {% endif %}
        </div>
        <p class="opinion__text more" style="max-height: 115px; overflow: hidden; width: 100%">{% if profile is defined and argument.isTrashed %}<span class="label label-default" style="position: static">{{ 'opinion.show.trashed.label'|trans({}, 'CapcoAppBundle') }}</span> {% endif %}{{ argument.body | escape | nl2br }}</p>

        {% if trashed is not defined %}

            {% if false == argument.canContribute %}
                <button disabled="disabled" class="btn  btn-dark-gray  btn-xs"><i class="cap-hand-like-2"></i> {{ 'argument.vote.submit'|trans({}, 'CapcoAppBundle') }}</button>
            {% else %}
                <form method="POST" style="display: inline-block;" action="{{ path('app_consultation_vote_argument' ,{'consultationSlug': consultation.slug, 'opinionTypeSlug': opinionType.slug, 'opinionSlug': opinion.slug, 'argumentId': argument.id } ) }}">
                    {% if argument.userHasVote(currentUser) %}
                        <button class="btn  btn-danger  btn-xs">{{ 'argument.vote.delete'|trans({}, 'CapcoAppBundle') }}</button>
                    {% else %}
                        <a class="connection-popover-js">
                            <button class="btn  btn-success  btn--outline  btn-xs"><i class="cap-hand-like-2"></i> {{ 'argument.vote.submit'|trans({}, 'CapcoAppBundle') }}</button>
                        </a>
                    {% endif %}
                    <input type="hidden" name="_csrf_token" value="{{ token }}">
                </form>
            {% endif %}
            <span class="opinion__votes-nb">{{ argument.VoteCount }}</span>

            {{ sonata_block_render({'type': 'capco.block.service.share_button'}, {
                'url': (url('app_consultation_show_opinion', {'consultationSlug': consultation.slug, 'opinionTypeSlug': opinionType.slug, 'opinionSlug': opinion.slug}) ~ '#arg-' ~ argument.id),
                'title': ('share_button.argument_on'|trans({'%opinion%': opinion.title}, 'CapcoAppBundle')),
                'btn_classes': 'btn-xs  btn-dark-gray  btn--outline',
            }) }}

            {% if argument.reports | length > 0 %}
                <button disabled="disabled" class="btn btn-xs btn-dark-gray"><i class="cap cap-flag-1"></i> {{ 'argument.report.reported'|trans({}, 'CapcoAppBundle') }}</button>
            {% else %}
                <a href="{{ path('app_report_argument' ,{'consultationSlug': consultation.slug, 'opinionTypeSlug': opinionType.slug, 'opinionSlug': opinion.slug, 'argumentId': argument.id } ) }}" class="btn btn-xs btn-dark-gray  btn--outline  connection-popover-js"><i class="cap cap-flag-1"></i> {{ 'argument.report.submit'|trans({}, 'CapcoAppBundle') }}</a>
            {% endif %}

            {% if argument.canContribute and currentUser is not null and currentUser == argument.Author %}
                <a href="{{ path('app_consultation_edit_argument' ,{'consultationSlug': consultation.slug, 'opinionTypeSlug': opinionType.slug, 'opinionSlug': opinion.slug, 'argumentId': argument.id } ) }}" class="btn  btn-dark-gray  btn--outline  btn-xs"><i class="cap cap-pencil-1"></i> {{ 'argument.update.button'|trans({}, 'CapcoAppBundle') }}</a>
            {% endif %}

        {% else %}
            <button disabled="disabled" class="btn  btn-default btn-xs"><i class="cap cap-hand-like-2"></i> {{ 'argument.vote.submit'|trans({}, 'CapcoAppBundle') }}</button>
            <span class="opinion__votes-nb">{{ argument.VoteCount }}</span>
        {% endif %}

    </div>
</li>
