{% extends '@CapcoApp/Blog/index.html.twig' %}

{% block canonical_link %}{{ url('app_blog_show', {'slug': post.slug}) }}{% endblock %}

{% block title %}
    {{ parent() }} - {{ post.title }}
{% endblock %}

{% block jumbotron %}{% endblock %}

{% block body %}
    <div class="container  container--custom">
        <h1><a href="{{ url('app_blog_show', {'slug': post.slug}) }}">{{ post.title | jolitypo() }}</a></h1>
        {% include 'CapcoAppBundle:Blog:_authors.html.twig' with {'authors': post.Authors, 'themes': post.themes, 'publishedAt': post.publishedAt} %}
    </div>

    <div class="container  container--custom">

        {%  if post.Media %}
            {% thumbnail post.Media, 'blockHeader' with {'title': post.Media.name, 'alt': post.Media.name, 'class': 'img-responsive'} %}
        {%  endif %}

        <div class="block">
            {{ post.body|raw | jolitypo() }}
        </div>

        {% if post.consultations | length > 0 %}
            <div class="block">
                <p>
                    {% transchoice post.consultations | length from 'CapcoAppBundle' %}
                        blog.show.consultations.title
                    {% endtranschoice %}
                </p>
                <ul>
                    {% for consultation in post.consultations %}
                        <li><a href="{{ path('app_consultation', {'slug': consultation.slug}) }}">{{ consultation.title }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {{ sonata_block_render({'type': 'capco.block.service.share_button'}, {
            'url': url('app_blog_show', {'slug': post.slug}),
            'title': post.title,
        }) }}
    </div>

    {% if capco_comment_can_add(post) or (capco_comment_can_show(post) and post.commentsCount > 0) %}
        <div class="container  container--custom">
            {% if capco_comment_can_show(post) and post.commentsCount > 0 %}
                {{ render(controller('CapcoAppBundle:Comment:showComments', {'object': post})) }}
            {% endif %}

            {% if capco_comment_can_add(post) %}
                {{ render(controller('CapcoAppBundle:Comment:create', {'objectId': post.id, 'objectType': post.className})) }}
            {% endif %}
        </div>
    {% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/readmore/readmore.js') }}"></script>
    <script type="text/javascript">
        $('.more').readmore({
            collapsedHeight: 98,
            moreLink: '<a href="#">{{ 'comment.read_more'|trans({}, 'CapcoAppBundle') }}</a>',
            lessLink: '<a href="#">{{ 'comment.read_less'|trans({}, 'CapcoAppBundle') }}</a>'
        });
    </script>
{% endblock %}
