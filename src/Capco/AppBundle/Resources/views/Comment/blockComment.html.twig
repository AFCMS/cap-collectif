{%  set currentUser = app.user %}
{% set author = comment.Author %}
<li class="opinion  opinion--comment {% if classes is defined %}{{ classes }}{% endif %}" id="comment-{{ comment.id }}">
    <div class="opinion__body">
        {% if null != author %}
            {% include 'CapcoUserBundle:Avatar:avatar.html.twig' with { 'user': author, 'link_classes': 'pull-left'} only %}
        {% else %}
            <span class="pull-left">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="45px" height="45px" viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve"><circle fill="{{ capco_site_color_value('color.section.bg')  }}" cx="100" cy="100" r="97.617"/><g><path fill="none" stroke="#FFFFFF" stroke-width="3" stroke-linejoin="round" stroke-miterlimit="10" d="M100,160.011h68.011c0,0,0-12.163-5.916-23.993c-4.41-8.819-22.024-14.039-45.683-22.908V95.367c0,0,7.239-6.661,7.239-18.49c2.959,0,5.916-11.826,0-14.785c0-1.754,7.927-16.569,5.916-26.613c-2.957-14.786-44.353-14.786-47.309-2.955c-17.742,0-5.915,27.169-5.915,29.568c-5.913,2.959-2.957,14.785,0,14.785c0,11.829,7.238,17.473,7.238,17.473v18.759c-23.655,8.875-41.273,14.089-45.682,22.908c-5.911,11.83-5.911,23.993-5.911,23.993H100z"/></g></svg>
            </span>
        {% endif %}
        <div class="opinion__data">
            <p class="h5  opinion__user">
                {% if null != author %}
                    <a href="{{ path('capco_user_profile_show_all', {'slug': author.slug}) }}">{{ author.username }}</a>
                {% else %}
                    {{ comment.authorName }}
                {% endif %}
            </p>
            <p class="excerpt  opinion__date">{{ comment.createdAt | localizeddate('long', 'short', app.request.locale) }}</p>
        </div>
        {% if profile is defined %}
            <p>{{ 'comment.linked_object' | trans({}, 'CapcoAppBundle') }} <a href="{{ capco_comment_object_url(comment) }}">{{ capco_comment_object(comment) }}</a></p>
        {% endif %}
        <p class="opinion__text more" style="max-height: 98px;">
            {% if comment.isTrashed %}<span class="label label-default" style="position: static">{{ 'comment.trashed.label'|trans({}, 'CapcoAppBundle') }}</span> {% endif %}
            {{ comment.body | escape | nl2br }}
        </p>

        {% if false == comment.canContribute %}
            <button disabled="disabled" class="btn  btn-dark-gray  btn-xs"><i class="cap-hand-like-2"></i> {{ 'comment.vote.submit'|trans({}, 'CapcoAppBundle') }}</button>
        {% else %}
            <form method="POST" style="display: inline-block;" action="{{ path('app_comment_vote', {'commentId': comment.id } ) }}">
                {% if comment.userHasVote(currentUser) %}
                    <button class="btn  btn-danger  btn-xs">{{ 'comment.vote.delete'|trans({}, 'CapcoAppBundle') }}</button>
                {% else %}
                    <button class="btn  btn-success  btn--outline  btn-xs"><i class="cap-hand-like-2"></i> {{ 'comment.vote.submit'|trans({}, 'CapcoAppBundle') }}</button>
                {% endif %}
                <input type="hidden" name="_csrf_token" value="{{ token }}">
            </form>
        {% endif %}
        <span class="opinion__votes-nb">{{ comment.VoteCount }}</span>

        {% if comment.userHasReport(currentUser) %}
            <button disabled="disabled" class="btn btn-xs btn-dark-gray"><i class="cap cap-flag-1"></i> {{ 'comment.report.reported'|trans({}, 'CapcoAppBundle') }}</button>
        {% else %}
            <a href="{{ path('app_report_comment' ,{'commentId': comment.id } ) }}" class="btn btn-xs btn-dark-gray  btn--outline"><i class="cap cap-flag-1"></i> {{ 'comment.report.submit'|trans({}, 'CapcoAppBundle') }}</a>
        {% endif  %}


        {% if comment.canContribute and currentUser is not null and currentUser == comment.Author and comment.canContribute %}
            <a href="{{ path('app_comment_edit' ,{'commentId': comment.id } ) }}" class="btn  btn-dark-gray  btn--outline  btn-xs"><i class="cap cap-pencil-1"></i> {{ 'comment.update.button'|trans({}, 'CapcoAppBundle') }}</a>
        {% endif %}

    </div>
</li>
