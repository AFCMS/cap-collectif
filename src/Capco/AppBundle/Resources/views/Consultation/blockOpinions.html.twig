{% extends '@CapcoApp/base.html.twig' %}

{% block jumbotron %}
{% endblock %}

{% block body %}
    <div class="container">

        <div class="consultation__title  block  block--shadowed">
            {% if consultation.Media %}
                {% thumbnail consultation.Media, 'blockHeader' with {'title': consultation.Media.name, 'alt': consultation.Media.name, 'class': 'img-responsive'} %}
            {% endif %}
            <div class="consultation__title__body">
                <div class="pull-left">
                    <h3 class="consultation__title__title  h3">{{ consultation.title }}</h3>
                </div>
                <div class="dropdown  pull-right  dropdown--social">
                    <button class="btn  btn-default" type="button" data-toggle="dropdown"><i class="cap-network-1"></i> Partager <span class="caret"></span></button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#"><i class="cap-facebook"></i> Facebook</a></li>
                        <li><a href="#"><i class="cap-twitter"></i> Twitter</a></li>
                        <li><a href="#"><i class="cap-gplus"></i> Google+</a></li>
                        <li><a href="#"><i class="cap-mail-1"></i> Mail</a></li>
                        <li><a class="copy-link"><i class="cap-link-1"></i> Copier le lien</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-xs-12  col-sm-4  col-md-3">
                <div class="thumbnail--custom  thumbnail--sidebar  block--shadowed">
                    {#<a href="#" class="play" data-length="3:50">#}
                    {#<img class="img-responsive  center-block" src="http://lorempixel.com/400/300/technics" alt="image de la consultation">#}
                    {#</a>#}
                    <div class="box">
                        <h4 class="h4">Introduction</h4>
                        <p>{{ consultation.body | striptags | truncate(200, true, '.') }}</p>
                        <a href="#" class="collapse  in  sidebar__description" data-toggle="collapse">Lire la suite</a>
                        <h4 class="h4">Étapes</h4>
                        <div class="navbar--sub">
                            <ul class="nav">
                                <li class="active">
                                    <a href="#">
                                        <div class="navbar__step-nb">1</div>
                                        <div class="navbar__step">
                                            <h3 class="navbar__step-title">Consultation  <i class="pull-right  excerpt  cap-arrow-66"></i></h3>
                                            <p class="excerpt h5">Du 30 septembre 2014 au 22 novembre 2014</p>
                                            <p class="label label-success">En cours</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="navbar__step-nb">2</div>
                                        <div class="navbar__step">
                                            <h3 class="navbar__step-title">Synthèse  <i class="pull-right  excerpt  cap-arrow-66"></i></h3>
                                            <p class="excerpt h5">Le 2 juillet 2014</p>
                                            <p class="label label-default">À venir</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="navbar__step-nb">3</div>
                                        <div class="navbar__step">
                                            <h3 class="navbar__step-title">Décisions  <i class="pull-right  excerpt  cap-arrow-66"></i></h3>
                                            <p class="excerpt h5">Le 2 août 2014</p>
                                            <p class="label label-default">À venir</p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <h4 class="h4">Informations</h4>
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label class="col-lg-5  control-label  excerpt">Thème</label>
                                <p class="col-lg-7  form-control-static">
                                    {% for theme in consultation.Themes %}
                                        <a href="{{ path('app_theme_show', {'slug': theme.slug}) }}">{{theme}}</a> {% if loop.last == false %} , {% endif %}
                                    {% endfor %}
                                </p>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5  control-label  excerpt">Publication</label>
                                <p class="col-lg-7  form-control-static">{{ consultation.openedAt | localizeddate('long', 'none') }}</p>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-5  control-label  excerpt">Contributions</label>
                                <p class="col-lg-7  form-control-static">
                                    {{ consultation.contributionCount }} votes<br/>
                                    37 propositions<br/>
                                    {{ consultation.argumentCount }} arguments
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-xs-12  col-sm-8  col-md-9" id="details">

                {{ render(controller('CapcoAppBundle:Consultation:getNavOpinionType', {'consultation': consultation.id, 'type': app.request.attributes.get('opinion_type_slug')})) }}

                <div class="block  block--shadowed">
                    <div class="opinion  opinion--{{ app.request.attributes.get('opiniontype').color }} opinion--default">
                        <div class="opinion__header  opinion__header--mobile-centered">
                            <h4 class="pull-left  h4  opinion__header__title">{{ app.request.attributes.get('opiniontype').title }} <span class="badge">{{ opinions|length }}</span></h4>
                            <div class="pull-right  opinion__header__filter">
                                <a href="#" class="btn  btn-default">
                                    <i class="cap cap-add-1"></i>
                                    <span class="hidden-xs  hidden-sm"> Proposer</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <ul class="media-list  opinion__list">
                        {% for opinion in opinions %}
                            {% set nbVotes = (opinion.getVotesAll) %}
                            {% set nbArguments = (opinion.arguments|length) %}
                            <li class="opinion  opinion--{{ opinion.slug }}">
                                <div class="row">
                                    <div class="col-xs-12  col-sm-10">
                                        <div class="opinion__body  box">
                                            {% if opinion.Author.Media %}
                                                <a class="pull-left" href="#">
                                                    {% thumbnail opinion.Author.Media, 'avatar' with {'title': opinion.Author.fullname, 'alt': opinion.Author.fullname, 'class': 'img-circle  pull-left'} %}
                                                </a>
                                            {% endif %}
                                            <div class="opinion__data">
                                                <p class="opinion__user  h5"><a href="#">{{ opinion.Author.getFullname }}</a> <span class="pull-right  excerpt">{{ opinion.createdAt | localizeddate('medium', 'none', app.request.locale) }}</span></p>
                                                <p class="opinion__title"><a href="{{ path('app_consultation_show_opinion', {'consultation_slug': consultation.slug, 'opinion_type_slug': app.request.attributes.get('opinion_type_slug'), 'opinion_slug': opinion.slug}) }}">{{ opinion.title }}</a></p>
                                                <p class="opinion__votes  excerpt h5">
                                                    {% transchoice nbVotes with {'%count%': nbVotes} from 'CapcoAppBundle' %}
                                                    consultation.show.votes
                                                    {% endtranschoice %}
                                                    •
                                                    {% transchoice nbArguments with {'%count%': nbArguments} from 'CapcoAppBundle' %}
                                                    consultation.show.arguments
                                                    {% endtranschoice %}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="hidden-xs col-sm-2 opinion__chart-block">
                                        <div id="pie-{{ opinion.id }}"></div>
                                    </div>
                                </div>
                                <ul class="sr-only" data-pie-id="pie-{{ opinion.id }}" data-options='{"percent_offset": "15"}'>
                                    <li data-value="{{ opinion.voteCountOk }}"></li>
                                    <li data-value="{{ opinion.voteCountMitige }}"></li>
                                    <li data-value="{{ opinion.voteCountNok }}"></li>
                                </ul>
                            </li>
                        {% endfor %}
                    </ul>
                </div>

                {% if nbPage > 1 %}
                    <div class="pagination--custom  text-center">
                        <ul class="pagination">
                            {% for p in range(1, nbPage) %}
                                <li{% if p == page %} class="active"{% endif %}>
                                    <a href="{{ path('app_consultation_show_opinions', {'consultation_slug': consultation.slug, 'opinion_type_slug': app.request.attributes.get('opinion_type_slug'), 'page': p}) }}">{{ p }}</a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

            </div> <!-- col-xs-12  col-sm-8  col-md-9 -->
        </div> <!-- .row -->
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/Snap.svg/dist/snap.svg-min.js') }}"></script>
    <script src="{{ asset('js/pizza/dist/js/pizza.js') }}"></script>
    <script type="text/javascript">
        Pizza.init();
    </script>
{% endblock %}

