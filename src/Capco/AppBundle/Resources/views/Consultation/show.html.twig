{% extends '@CapcoApp/base.html.twig' %}

{% block canonical_link %}{{ url('app_consultation_show', {'slug': consultation.slug}) }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('js/fancybox/jquery.fancybox.css') }}" rel="stylesheet">
{% endblock %}

{% block title %}
    {{ parent() }} - {{ consultation.title }}
{% endblock %}

{% block jumbotron %}
{% endblock %}

{% block body %}

    <div class="container">
        {% include '@CapcoApp/Consultation/show_title.html.twig' %}
    </div>

    <div class="container">

        {% if consultation.isClose %}
        <div class="alert alert-info alert-dismissible  block" role="alert">
            <p><strong>{{ 'consultation.show.alert.ended.title'|trans({}, 'CapcoAppBundle') }}</strong> {{ 'consultation.show.alert.ended.text'|trans({}, 'CapcoAppBundle') }}</p>
        </div>
        {% endif %}

        {% if consultation.isFuture %}
        <div class="alert alert-info alert-dismissible  block" role="alert">
            <p><strong>{{ 'consultation.show.alert.future.title'|trans({}, 'CapcoAppBundle') }}</strong> {{ 'consultation.show.alert.future.text'|trans({'%date%': '<strong>' ~ consultation.getOpenedAt| localizeddate('long', 'none', app.request.locale) ~ '</strong>'}, 'CapcoAppBundle') | raw }}</p>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-xs-12  col-sm-4  col-md-3  block--mobile">
                {% include '@CapcoApp/Consultation/show_meta.html.twig' %}
            </div>
            {% set opinionTypeCurrent = app.request.attributes.get('opinionTypeSlug') %}
            {% if app.request.attributes.get('_route') == 'app_consultation_show_trashed' %}
                {% set opinionTypeCurrent = 'trashed' %}
            {% endif %}
            <div class="col-xs-12  col-sm-8  col-md-9" id="details">
                {% include '@CapcoApp/Consultation/show_nav.html.twig' with {'type': opinionTypeCurrent, 'consultation': consultation} %}
                {% block opinions_list %}
                    {{ render(controller('CapcoAppBundle:Consultation:showOpinions', {'consultation': consultation.id})) }}
                {% endblock %}
            </div> <!-- col-xs-12  col-sm-8  col-md-9 -->
        </div> <!-- .row -->
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="{{ asset('js/readmore/readmore.js') }}"></script>
    <script type="text/javascript">
        App.module.pieChart();
        $('.more').readmore({
            collapsedHeight: 115,
            moreLink: '<a href="#">{{ 'consultation.show.meta.intro.read_more'|trans({}, 'CapcoAppBundle') }}</a>', //BazingaJsTranslationBundle
            lessLink: '<a href="#">{{ 'consultation.show.meta.intro.read_less'|trans({}, 'CapcoAppBundle') }}</a>'
        });
        {% if consultation.video %}
        App.module.video('.fancybox');
        {% endif %}
    </script>
{% endblock %}
