{% macro contributions_popover(consultation) %}
    {% set opinions = consultation.totalOpinionsCount %}
    {% transchoice opinions with {'%count%': opinions} from 'CapcoAppBundle'  %}
        consultation.show.meta.opinionsCount
    {% endtranschoice %}
    </br>
    {% set arguments = consultation.totalArgumentsCount %}
    {% transchoice arguments with {'%count%': arguments} from 'CapcoAppBundle'  %}
        consultation.show.meta.argumentsCount
    {% endtranschoice %}
    {#</br>
    {% transchoice consultation.sourcesCount with {'%count%': consultation.sourcesCount} from 'CapcoAppBundle'  %}
        consultation.show.sourcesCount
    {% endtranschoice %}
    </br>
    {% transchoice consultation.votesCount with {'%count%': consultation.votesCount} from 'CapcoAppBundle'  %}
        consultation.show.votesCount
    {% endtranschoice %}#}
{% endmacro %}

{% import _self as render %}

<div class="row">
    <div class="col-xs-12 col-sm-5">
        {% if consultation.video is not null %}
            <a href="{{ consultation.video }}" class="play fancybox" data-type="iframe">
        {% endif %}
        {% if consultation.Cover %}
            {% thumbnail consultation.Cover, 'blockHeader' with {'title': consultation.Cover.name, 'alt': consultation.Cover.name, 'class': 'img-responsive'} %}
        {% else %}
            <div class="bg__wrapper">
                <div class="bg--default bg--consultation">
                    {% if consultation.video is null %}
                        <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="110px" height="110px" viewBox="-162.5 -162.5 226.5 226.5" enable-background="new -162.5 -162.5 226.5 226.5" xml:space="preserve" style="margin: 0 auto; display: block;">
                            <path fill="none" stroke="#FFFFFF" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M-27.254-143.396h-91.487c-20.386,0-36.596,16.21-36.596,36.595v32.934c0,20.386,16.525,32.934,36.907,32.934h14.323v40.252l36.436-40.252h40.417c20.382,0,40.251-16.21,40.251-36.595v-29.275C13.001-127.187-6.865-143.396-27.254-143.396z"/>
                            <path fill="none" stroke="#FFFFFF" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M-52.87-4.331c0,12.74,9.215,21.952,21.959,21.952h21.952L20.32,46.896V17.621h13.662c12.814,0,23.17-10.445,23.066-23.256l-0.137-16.84c0-12.736-9.208-22.111-21.952-22.111"/>
                        </svg>
                    {% endif %}
                </div>
            </div>
        {% endif %}
        {% if consultation.video is not null %}
            </a>
        {% endif %}
    </div>
    <div class="col-xs-12 col-sm-7">
        <h1 class="consultation__header__title  h1">{{ consultation.title }}</h1>

        {% if consultation.Author is not null %}
            <div class="media">
                {% include 'CapcoUserBundle:Avatar:avatar.html.twig' with {'user': consultation.Author, 'classes': 'media-object', 'link_classes': 'pull-left'} only %}
                <div class="media-body">
                    <p class="media--aligned  excerpt">
                        <a href="{{ path('capco_user_profile_show_all', {'slug': consultation.Author.slug}) }}">
                            {{ consultation.Author.username }}
                        </a>{{ 'consultation.show.in_theme' | trans({}, 'CapcoAppBundle') }}
                        {% for theme in consultation.Themes %}
                        <a href="{{ path('app_theme_show', {'slug': theme.slug}) }}">{{ theme.title }}</a>{% if not loop.last %},{% endif %}{% endfor %},
                        {{ 'consultation.show.on_date' | trans({'%date%': consultation.publishedAt | localizeddate('long', 'none')}, 'CapcoAppBundle') }}
                    </p>
                </div>
            </div>
        {% endif %}

        <ul class="nav nav-pills consultation__infos">
            {% set contributionsCount = consultation.contributionsCount %}
            {% if contributionsCount > 0 %}
                <li data-toggle="tooltip" data-placement="top" data-html="true" data-title="{{ render.contributions_popover(consultation) }}">
                    <div class="value">{{ contributionsCount }}</div>
                    <div class="excerpt category">
                        {% transchoice contributionsCount from 'CapcoAppBundle' %}
                            consultation.show.meta.total_count
                        {% endtranschoice %}
                    </div>
                </li>
            {% endif %}
            {% set contributorsCount = consultation.participantsCount %}
            {% if contributorsCount > 0 %}
                <li>
                    <a href="{{ path('app_consultation_show_contributors', {'consultationSlug': consultation.slug}) }}">
                        <div class="value">{{ contributorsCount }}</div>
                        <div class="excerpt category">
                            {% transchoice contributorsCount from 'CapcoAppBundle' %}
                            consultation.show.meta.contributors_count
                            {% endtranschoice %}
                        </div>
                    </a>
                </li>
            {% endif %}
            {% set openStep = consultation.currentStep %}
            {% if null != openStep %}
                <li data-toggle="tooltip" data-placement="top" title="{{ 'consultation.show.end_at' | trans({'%date%': openStep.endAt | localizeddate('long', 'none')}, 'CapcoAppBundle') }}">
                    {% set remDays = openStep.remainingDays | default('0') %}
                    <div class="value">{{ remDays }}</div>
                    <div class="excerpt  category">
                        {% transchoice remDays from 'CapcoAppBundle' %}
                            consultation.show.meta.remaining_days
                        {% endtranschoice %}
                    </div>
                </li>
            {% endif %}
        </ul>

        {% set consultationStepOpen = consultation.consultationStepOpen %}
        {% if consultationStepOpen and consultationStepOpen.canContribute %}
            <a class="btn  btn-primary" href="{{ path('app_consultation_show', {'consultationSlug': consultation.slug, 'stepSlug': consultationStepOpen.slug}) }}">{{ 'step.presentation.participe' | trans({}, 'CapcoAppBundle') }}</a>
        {% endif %}

        {{ sonata_block_render({'type': 'capco.block.service.share_button'}, {
            'url': (consultation | capco_first_step_link(true)),
            'title': consultation.title
        }) }}

        {% if consultation.exportable %}
            {% include 'CapcoAppBundle:Consultation:download_button.html.twig' with {'consultation': consultation} only %}
        {% endif %}
    </div>
</div>
