{% macro nav_item(pathInfo, link, text) %}
    <li{% if pathInfo == link or pathInfo starts with '/' ~ link %} class="active"{% endif %}><a href="{{ menu_url(link) }}">{{ text }}</a></li>
{% endmacro %}
{% from _self import nav_item %}

{# Navbar content  #}
<div class="collapse navbar-collapse" id="navbar-collapse">
    <ul class="nav navbar-nav" id="navbar-content">
        {% for headerLink in headerLinks %}
            {% if headerLink.hasEnabledFeature %}
                {% if headerLink.children|length > 0 %}
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ headerLink.title}} <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            {% for child in headerLink.children %}
                                {% if child.hasEnabledFeature %}
                                    {{ nav_item(pathInfo, child.link, child.title) }}
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </li>
                {% else %}
                    {{ nav_item(pathInfo, headerLink.link, headerLink.title) }}
                {% endif %}
            {% endif %}
        {% endfor %}
    </ul>

    {# Connection button #}
    {% if app.user %}
        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ app.user.username }}<span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                    {% if is_granted('ROLE_ADMIN') %}
                        <li><a href="{{ path('sonata_admin_dashboard') }}">{{ 'header.administration'|trans({}, 'CapcoAppBundle') }}</a></li>
                    {% endif %}
                    <li><a href="{{ path('fos_user_profile_show') }}">{{ 'header.profile'|trans({}, 'CapcoAppBundle') }}</a></li>
                    <li><a href="{{ path('fos_user_profile_edit') }}">{{ 'header.user_settings'|trans({}, 'CapcoAppBundle') }}</a></li>
                    <li class="divider"></li>
                    <li><a href="{{ path('fos_user_security_logout') }}"> {{ 'layout.logout'|trans({}, 'FOSUserBundle') }} </a></li>
                </ul>
            </li>
        </ul>
    {% else %}
    <div class="nav navbar-right">
        {% if is_feature_enabled('registration') %}
            <a href="{{ path('fos_user_registration_register') }}" class="btn  btn-primary  btn-brand  navbar-btn">{{ 'layout.register'|trans({}, 'FOSUserBundle') }}</a>
        {% endif %}
        <a href="{{ path('fos_user_security_login') }}" class="btn  btn-darkest-gray  navbar-btn  btn--connection">{{ 'layout.login'|trans({}, 'FOSUserBundle') }}</a>
    </div>
    {% endif %}
</div>
