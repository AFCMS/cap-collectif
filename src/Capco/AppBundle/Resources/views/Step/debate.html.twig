{% extends '@CapcoApp/Project/layout_with_widget.html.twig' %}

{% set isConsultationType = currentStep is defined and currentStep.type  is defined  and currentStep.type  != 'consultation' %}
{% set isConsultationRoute= app.request.get('_route') == 'app_project_show_consultations' %}
{% set getConsultations = currentStep is defined and currentStep.type is defined and currentStep.type  == 'consultation' and currentStep.consultations.count <= 1 %}
{% set isConsultation = isConsultationType or isConsultationRoute or getConsultations %}
{% set shouldDisplayProjectHeader = currentStep is defined and currentStep.slug is defined and isConsultation %}

{% set stepsParticipation = ["app_project_show_consultation", "app_project_show_collect", "app_project_show_selection"] %}
{% set showTrash = is_feature_enabled('project_trash') and app.request.get('_route') in stepsParticipation %}

{% block canonical_link %}{{ url('app_project_show_debate', {'projectSlug': project.slug, 'stepSlug': currentStep.slug}) }}{% endblock %}

{% block metaTags %}
    {% set image %}{% if project.Cover %}{% path project.Cover, 'blockHeader' %}{% endif %}{% endset %}
    {% set title = currentStep.title ~ ' ' ~ 'of.project' | trans({}, 'CapcoAppBundle') ~ ' ' ~ project.title %}
    {% include 'CapcoAppBundle:Default:meta.html.twig' with {
        'title':       title,
        'type':        'project',
        'description': currentStep.metaDescription ?: currentStep.body|striptags|truncate(250, true),
        'author':      is_feature_enabled('profiles') ? url('capco_user_profile_show_all', {'slug': project.firstAuthor.slug}) : null,
        'image':       image,
        'url':         url('app_project_show_ranking', {'projectSlug': project.slug, 'stepSlug': currentStep.slug})
    } only %}
{% endblock %}

{% block title %}
    {{ parent() }} - {{ currentStep.title }}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('js/fancybox/jquery.fancybox.css') }}" rel="stylesheet">
{% endblock %}

{% block jumbotron %}{% endblock %}
{% block body %}
    {% if shouldDisplayProjectHeader %}
        <section>
            <div class="container">
                {% include '@CapcoApp/Project/show_title.html.twig' %}
            </div>
        </section>
    {% endif %}

    {% if project.steps | length > 1 and shouldDisplayProjectHeader %}
        <section>
            {{ react_render_component('ProjectStepTabsApp', {
                'props': {
                    'projectId': project.id|toGlobalId('Project')
                },
            }) }}
        </section>
    {% endif %}

    {% block stepNavigation %}{% endblock %}
    <section style="background: #f7f7f7; border-top: 1px solid #e5e5e5;">
    <div class="container">
    {{ react_render_component('DebateStepPageApp',
    { 'props':
        { stepId: currentStep.id|toGlobalId('DebateStep'),
          title: currentStep.title } 
          })
    }}
    </div>
    </section>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/sonatacore/vendor/bootstrap/js/modal.js') }}"></script>
    {% if currentStep.customCode is defined and currentStep.customCode != '' %}{{ currentStep.customCode | raw }}{% endif %}
{% endblock %}
