{% set state = {
  'intl': {
    'locale': intl_locale(),
    'messages': intl_messages(),
  },
  'default': {
    'themes': themes_list(),
    'features': features_list(),
    'userTypes': user_type_list()|default([]),
    'parameters': site_parameters_list(),
  },
  'user': {
    'registration_form': registration_form_serialize(),
    'user': app.user
      ? {
        'id': app.user.id,
        'username': app.user.username,
        'isEmailConfirmed': app.user.isEmailConfirmed,
        'isPhoneConfirmed': app.user.isPhoneConfirmed,
        'phone': app.user.phone,
        'isAdmin': app.user.isAdmin,
        'isEvaluer': app.user.isEvaluer,
        'email': app.user.email,
        'newEmailToConfirm': app.user.newEmailToConfirm,
        'notificationsConfiguration': app.user.notificationsConfiguration.notificationsValues,
        'media': app.user.Media
        ? {
            'url': media_public_url(app.user.Media, 'default_avatar')
          }
        : null,
        'displayName': app.user.username,
        'uniqueId': app.user.slug,
        'roles': app.user.roles,
      }
    : null,
  },
  'project': {
    'visibleProjects': [],
    'currentProjectStepById': currentStep.id|default(null),
    'currentProjectById': project.id|default(null),
    'projectsById': list_projectsById(),
    'projectTypes': projectReducerData.projectTypes|default([]),
    'page': projectReducerData.page|default(null),
    'limit': projectReducerData.limit|default(null),
    'orderBy': projectReducerData.orderBy|default(null),
    'term': projectReducerData.term|default(null),
    'type': projectReducerData.type|default(null),
    'theme': projectReducerData.theme|default(null)
  },
}
%}
{% dump app.user %}
{% set state = state|merge(data is defined ? data : {}) %}
{{ redux_store('appStore', state) }}
