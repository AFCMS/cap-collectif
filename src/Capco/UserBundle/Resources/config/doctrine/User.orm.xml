<?xml version="1.0" encoding="UTF-8"?>
<doctrine-mapping xmlns="http://doctrine-project.org/schemas/orm/doctrine-mapping"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:schemaLocation="http://doctrine-project.org/schemas/orm/doctrine-mapping
                  http://doctrine-project.org/schemas/orm/doctrine-mapping.xsd"
                  xmlns:gedmo="http://gediminasm.org/schemas/orm/doctrine-extensions-mapping">

    <entity name="Capco\UserBundle\Entity\User"
            table="fos_user"
            repository-class="Capco\UserBundle\Repository\UserRepository">
        <id name="id" column="id" type="guid">
            <generator strategy="UUID" />
        </id>

        <lifecycle-callbacks>
            <lifecycle-callback type="prePersist" method="sanitizePhoneNumber"/>
            <lifecycle-callback type="preUpdate" method="sanitizePhoneNumber"/>
        </lifecycle-callbacks>

        <indexes>
            <index name="username_idx" columns="username"/>
            <index name="id_username_idx" columns="id,username"/>
            <!-- sonata_admin_retrieve_autocomplete_items -->
            <index name="id_username_updated_at_idx" columns="id,username,updated_at"/>
            <index name="email_idx" columns="email"/>
            <!-- account_confirm_email -->
            <index name="new_email_confirmation_token_idx" columns="new_email_confirmation_token"/>
            <!-- fos_user_resetting_reset -->
            <index name="reset_password_token_idx" columns="reset_password_token"/>
        </indexes>

        <unique-constraints>
            <unique-constraint columns="slug" name="slug_idx" />
        </unique-constraints>

        <field name="samlId" unique="true" column="saml_id" type="string" length="255" nullable="true" />
        <field name="parisId" unique="true" column="paris_id" type="string" length="255" nullable="true" />
        <field name="locked" column="locked" type="boolean"/>
        <field name="credentialsExpired" column="credentials_expired" type="boolean"/>
        <field name="credentialsExpireAt" column="credentials_expire_at" type="datetime" nullable="true"/>

        <field name="slug" column="slug" type="string" length="255" nullable="false">
            <gedmo:slug unique="true" style="default" updatable="true" separator="" fields="username" />
        </field>

        <field name="facebook_id" column="facebook_id" type="string" length="255" nullable="true" />
        <field name="facebook_access_token" column="facebook_access_token" type="string" length="255" nullable="true" />
        <field name="facebookUrl" column="facebook_url" type="string" length="255" nullable="true" />

        <field name="google_id" column="google_id" type="string" length="255" nullable="true" />
        <field name="google_access_token" column="google_access_token" type="string" length="255" nullable="true" />

        <field name="openId" column="openid_id" type="string" length="255" nullable="true" />
        <field name="openIdAccessToken" column="openid_access_token" type="string" length="255" nullable="true" />

        <field name="linkedInUrl" column="linked_in_url" type="string" length="255" nullable="true" />

        <field name="twitter_id" column="twitter_id" type="string" length="255" nullable="true" />
        <field name="twitter_access_token" column="twitter_access_token" type="string" length="255" nullable="true" />
        <field name="twitterUrl" column="twitter_url" type="string" length="255" nullable="true" />
        <field name="websiteUrl" column="website_url" type="string" nullable="true"/>
        <field name="profilePageIndexed" column="profile_page_indexed" type="boolean" nullable="false">
            <options>
                <option name="default">1</option>
            </options>
        </field>

        <attribute-overrides>

            <attribute-override name="updatedAt">
                <field name="updatedAt" column="updated_at" type="datetime" nullable="true" />
            </attribute-override>

            <attribute-override name="usernameCanonical">
                <field column="username_canonical" type="string" length="255" unique="false" nullable="true"/>
            </attribute-override>
            <attribute-override name="username">
                <field column="username" type="string" length="255" unique="false" nullable="true"/>
            </attribute-override>
            <attribute-override name="email">
                <field column="email" type="string" length="255" nullable="true" />
            </attribute-override>
            <attribute-override name="emailCanonical">
                <field column="email_canonical" type="string" length="255" nullable="true" unique="true"/>
            </attribute-override>
            <attribute-override name="password">
                <field column="password" type="string" length="255" nullable="true" />
            </attribute-override>
        </attribute-overrides>

        <field name="newEmailToConfirm" column="new_email_to_confirm" type="string" length="255" nullable="true" />
        <field name="newEmailConfirmationToken" column="new_email_confirmation_token" type="string" length="255" nullable="true" />
        <field name="resetPasswordToken" column="reset_password_token" type="string" length="255" nullable="true" />

        <many-to-one field="media" target-entity="Capco\MediaBundle\Entity\Media">
            <cascade>
                <cascade-persist/>
            </cascade>
            <join-column name="media_id" referenced-column-name="id" nullable="true" on-delete="SET NULL" />
        </many-to-one>

        <field name="address" column="address" type="string" length="255" nullable="true" />
        <field name="address2" column="address2" type="string" length="255" nullable="true" />
        <field name="zipCode" column="zip_code" type="string" length="10" nullable="true" />
        <field name="city" column="city" type="string" length="255" nullable="true" />
        <field name="neighborhood" column="neighborhood" type="string" length="255" nullable="true" />

        <field name="encoder" column="encoder" type="string" length="255" nullable="true" />

        <one-to-many field="opinions" target-entity="Capco\AppBundle\Entity\Opinion" mapped-by="Author" />
        <one-to-many field="opinionVersions" target-entity="Capco\AppBundle\Entity\OpinionVersion" mapped-by="author" />
        <one-to-many field="comments" target-entity="Capco\AppBundle\Entity\Comment" mapped-by="Author" />
        <one-to-many field="arguments" target-entity="Capco\AppBundle\Entity\Argument" mapped-by="Author" />
        <one-to-many field="sources" target-entity="Capco\AppBundle\Entity\Source" mapped-by="author" />
        <one-to-many field="votes" target-entity="Capco\AppBundle\Entity\AbstractVote" mapped-by="user" />
        <one-to-many field="responses" target-entity="Capco\AppBundle\Entity\Responses\AbstractResponse" mapped-by="user" orphan-removal="true">
          <cascade>
              <cascade-persist/>
              <cascade-remove/>
          </cascade>
        </one-to-many>

        <field name="postCommentsCount" column="post_comments_count" type="integer" nullable="false" />
        <field name="proposalCommentsCount" column="proposal_comments_count" type="integer" nullable="false" />

        <field name="commentVotesCount" column="comment_votes_count" type="integer" nullable="false" />
        <field name="proposalVotesCount" column="proposal_votes_count" type="integer" nullable="false" />
        <field name="opinionVotesCount" column="opinion_votes_count" type="integer" nullable="false" />
        <field name="opinionVersionVotesCount" column="opinion_version_votes_count" type="integer" nullable="false" />
        <field name="sourceVotesCount" column="source_votes_count" type="integer" nullable="false" />
        <field name="argumentVotesCount" column="argument_votes_count" type="integer" nullable="false" />

        <field name="projectsCount" column="projects_count" type="integer" nullable="false" />
        <field name="proposalsCount" column="proposals_count" type="integer" nullable="false" />
        <field name="repliesCount" column="replies_count" type="integer" nullable="false" />
        <field name="argumentsCount" column="arguments_count" type="integer" nullable="false" />
        <field name="sourcesCount" column="sources_count" type="integer" nullable="false" />
        <field name="opinionsCount" column="opinions_count" type="integer" nullable="false" />
        <field name="opinionVersionsCount" column="opinion_versions_count" type="integer" nullable="false" />
        <field name="deletedAccountAt" column="deleted_account_at" type="datetime" nullable="true" />

        <field name="remindedAccountConfirmationAfter24Hours" column="remind_account_confirmation" type="boolean" nullable="false" />

        <many-to-one field="userType" target-entity="Capco\UserBundle\Entity\UserType">
            <cascade>
                <cascade-persist/>
            </cascade>
            <join-column name="user_type_id" referenced-column-name="id" nullable="true" on-delete="SET NULL" />
        </many-to-one>

        <one-to-one field="notificationsConfiguration" target-entity="Capco\AppBundle\Entity\UserNotificationsConfiguration" inversed-by="user">
            <cascade>
                <cascade-persist/>
                <cascade-remove/>
            </cascade>
            <join-column name="notifications_configuration_id" referenced-column-name="id"/>
        </one-to-one>

        <one-to-many target-entity="Capco\AppBundle\Entity\UserArchive" mapped-by="user" field="archives" orphan-removal="true">
            <cascade>
                <cascade-persist/>
                <cascade-remove/>
            </cascade>
        </one-to-many>

        <one-to-many target-entity="Capco\AppBundle\Entity\Proposal" mapped-by="author" field="proposals">

        </one-to-many>
        <one-to-many target-entity="Capco\AppBundle\Entity\Follower" mapped-by="user" field="followingContributions">
            <cascade>
                <cascade-persist/>
                <cascade-remove/>
            </cascade>
        </one-to-many>

        <one-to-many target-entity="Capco\AppBundle\Entity\Reply" mapped-by="author" field="replies">
        </one-to-many>

        <one-to-many target-entity="Capco\AppBundle\Entity\UserGroup" mapped-by="user" field="userGroups" />

        <field name="vip" column="vip" type="boolean" />
        <field name="emailConfirmationSentAt" column="email_confirmation_sent_at" type="datetime" nullable="true" />

        <field name="smsConfirmationCode" column="phone_confirmation_code" type="integer" nullable="true" />
        <field name="smsConfirmationSentAt" column="phone_confirmation_sent_at" type="datetime" nullable="true" />
        <field name="phoneConfirmed" column="phone_confirmed" type="boolean" nullable="false" />
        <field name="consentExternalCommunication" column="consent_external_communication" type="boolean" nullable="false" />
        <field name="consentInternalCommunication" column="consent_internal_communication" type="boolean" nullable="false" />
    </entity>

</doctrine-mapping>
