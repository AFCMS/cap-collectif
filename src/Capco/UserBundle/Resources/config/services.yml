services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  Capco\UserBundle\Authenticator\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Authenticator/*'

  Capco\UserBundle\Controller\ConfirmationController:
    autowire: true

  Capco\UserBundle\Controller\MembersController:
    autowire: true

  Capco\UserBundle\Controller\ProfileController:
    autowire: true
    public: true

  Capco\UserBundle\Form\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Form/*'

  Capco\UserBundle\Listener\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Listener/*'

  Capco\UserBundle\MonCompteParis\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/MonCompteParis/*'

  Capco\UserBundle\Security\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Security/*'
    exclude: '%kernel.root_dir%/../src/Capco/UserBundle/Security/Exception/*'

  # Redeclare Sonata services
  sonata.user.admin.group:
    abstract: false
    public: true
  sonata.user.orm.group_manager:
    abstract: false
    public: true

  Capco\UserBundle\Security\Core\User\OauthUserProvider:
    arguments:
      - '@fos_user.user_manager'
      - '@Capco\UserBundle\OpenID\OpenIDExtraMapper'
      - { facebook: facebook_id, google: google_id }

  Capco\UserBundle\Security\Core\User\SamlUserProvider:
    arguments:
      $samlIdp: '%simplesamlphp.sp%'

  Capco\UserBundle\Listener\UserNotificationsListener:
    tags:
      - { name: doctrine.orm.entity_listener, event: prePersist }
    arguments: ['@fos_user.util.token_generator']

  Capco\UserBundle\Security\Core\User\UserEmailProvider:
    arguments: ['@fos_user.user_manager', {}]

  Capco\UserBundle\Authenticator\SamlAuthenticator:
    arguments:
      $samlIdp: '%simplesamlphp.sp%'

  Capco\UserBundle\Doctrine\UserManager:
    autowire: true
    autoconfigure: true
    public: true
    arguments:
      $class: '%fos_user.model.user.class%'

  Capco\UserBundle\Security\Http\Logout\LogoutSuccessHandler:
    autowire: true
    autoconfigure: true
    arguments:
      $openIDResourceOwner: '@hwi_oauth.resource_owner.openid'
      $franceConnectResourceOwner: '@hwi_oauth.resource_owner.franceconnect'

  Capco\UserBundle\OpenID\OptionsModifier\OpenIDOptionsModifier:
    autowire: true
    autoconfigure: true

  Capco\UserBundle\FranceConnect\FranceConnectOptionsModifier:
    autowire: true
    autoconfigure: true

  Capco\UserBundle\OpenID\OpenIDExtraMapper:
    arguments: ['%instance_name%']

  Capco\UserBundle\OpenID\OpenIDReferrerResolver:
    arguments: ['%instance_name%']
