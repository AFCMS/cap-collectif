services:
    # Redeclare Sonata services
  sonata.user.admin.group:
    abstract: false
    public: true
  sonata.user.orm.group_manager:
    abstract: false
    public: true

  my_user_provider:
    class: Capco\UserBundle\Security\Core\User\UserProvider
    arguments: ["@fos_user.user_manager" ,{facebook: facebook_id, google: google_id}]

  saml_user_provider:
    class: Capco\UserBundle\Security\Core\User\SamlUserProvider
    arguments: ["@fos_user.user_manager", "%simplesamlphp.sp%"]

  capco_user.registration.form.type:
    class: Capco\UserBundle\Form\Type\ApiRegistrationFormType
    arguments: ["@capco.toggle.manager", "@capco.form.transformer.entity_to_id"]
    tags:
      - { name: form.type, alias: capco_user_registration }

  capco_user.profile.form.type:
    class: Capco\UserBundle\Form\Type\ProfileFormType
    arguments: ["@capco.toggle.manager"]
    tags:
      - { name: form.type }

  capco_user.user_provider.email:
    class: Capco\UserBundle\Security\Core\User\UserEmailProvider
    arguments: ["@fos_user.user_manager", {}]

  drupal.encoder:
    class: Capco\UserBundle\Security\DrupalEncoder

  capco_user.change_password.form.type:
      class: Capco\UserBundle\Form\Type\ChangePasswordFormType
      tags:
          - { name: form.type }

  # Saml
  capco.logout_handler:
      class: Capco\UserBundle\Security\Http\Logout\LogoutSuccessHandler
      arguments: ["@simplesamlphp.auth", "@router", "@capco.toggle.manager"]

  capco.saml.authenticator:
      class: Capco\UserBundle\Saml\SamlAuthenticator
      arguments: ["@simplesamlphp.auth", "%simplesamlphp.sp%", "@security.http_utils", "@capco.toggle.manager"]

  # We override default security services:
  security.authentication.success_handler:
      class:  Capco\UserBundle\Handler\AuthenticationSuccessHandler
      arguments:  ["@security.http_utils", {}]
      tags:
          - { name: 'monolog.logger', channel: 'security' }
  security.authentication.failure_handler:
      class:  Capco\UserBundle\Handler\AuthenticationFailureHandler
      arguments:  ["@http_kernel", "@security.http_utils", {}, "@logger"]
      tags:
          - { name: 'monolog.logger', channel: 'security' }
