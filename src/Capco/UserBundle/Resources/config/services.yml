services:
  _defaults:
    autowire: true
    autoconfigure: true
    public: false

  Capco\UserBundle\Authenticator\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Authenticator/*'
  #    exclude: '%kernel.root_dir%/../src/Capco/UserBundle/{Security/Exception/*, Repository/*,Entity/*, DependencyInjection/*, Controller/*}'

  Capco\UserBundle\Form\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Form/*'

  Capco\UserBundle\Listener\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Listener/*'

  Capco\UserBundle\MonCompteParis\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/MonCompteParis/*'

  Capco\UserBundle\Security\:
    resource: '%kernel.root_dir%/../src/Capco/UserBundle/Security/*'
    exclude: '%kernel.root_dir%/../src/Capco/UserBundle/Security/Exception/*'

  # Redeclare Sonata services
  sonata.user.admin.group:
    abstract: false
    public: true
  sonata.user.orm.group_manager:
    abstract: false
    public: true

  capco.oauth.provider:
    class: Capco\UserBundle\Security\Core\User\OauthUserProvider
    arguments: ['@fos_user.user_manager', { facebook: facebook_id, google: google_id }]

  Capco\UserBundle\Security\Core\User\OauthUserProvider:
    arguments: ['@fos_user.user_manager', { facebook: facebook_id, google: google_id }]

  Capco\UserBundle\Security\Core\User\SamlUserProvider:
    arguments:
      $samlIdp: '%simplesamlphp.sp%'

  Capco\UserBundle\Listener\UserNotificationsListener:
    tags:
      - { name: doctrine.orm.entity_listener, event: prePersist }
    arguments: ['@fos_user.util.token_generator']

  Capco\UserBundle\Security\Core\User\UserEmailProvider:
    arguments: ['@fos_user.user_manager', {}]
    alias: 'capco_user.user_provider.email'

  drupal.encoder:
    class: Capco\UserBundle\Security\DrupalEncoder

  Capco\UserBundle\Authenticator\SamlAuthenticator:
    arguments:
      $samlIdp: '%simplesamlphp.sp%'

  capco_user.user_provider.email:
    class: Capco\UserBundle\Security\Core\User\UserEmailProvider
    arguments: ['@fos_user.user_manager', {}]

  Capco\UserBundle\Doctrine\UserManager:
    autowire: true
    autoconfigure: true
    public: true
    arguments:
      $class: '%fos_user.model.user.class%'
